package vakiliner.chatcomponentapi.component;

import java.util.Objects;
import java.util.Set;
import java.util.function.Supplier;
import vakiliner.chatcomponentapi.common.ChatTextColor;

public class ChatComponentWithLegacyText extends ChatComponentModified {
	private final Supplier<ChatComponent> getLegacyComponent;
	private ChatComponent legacyComponent;

	protected ChatComponentWithLegacyText(ChatComponent component, Supplier<ChatComponent> getLegacyComponent) {
		super(component);
		this.getLegacyComponent = Objects.requireNonNull(getLegacyComponent);
	}

	protected ChatComponentWithLegacyText(ChatComponent component, ChatComponent legacyComponent) {
		super(component);
		this.getLegacyComponent = () -> this.legacyComponent;
		this.legacyComponent = Objects.requireNonNull(legacyComponent);
	}

	protected ChatComponentWithLegacyText(ChatComponentWithLegacyText component) {
		super(component);
		this.getLegacyComponent = component.getLegacyComponent;
		this.legacyComponent = component.legacyComponent;
	}

	public ChatComponent getLegacyComponent() {
		if (this.legacyComponent != null) {
			return this.legacyComponent;
		}
		synchronized (this) {
			if (this.legacyComponent != null) {
				return this.legacyComponent;
			}
			return this.legacyComponent = this.getLegacyComponent.get();
		}
	}

	public ChatComponent clone(boolean cloneExtra) {
		return new ChatComponentWithLegacyText(this);
	}

	public String toLegacyText() {
		return this.getLegacyComponent().toLegacyText();
	}

	public String toLegacyText(ChatTextColor parentColor, Set<ChatComponentFormat> parentFormats) {
		return this.getLegacyComponent().toLegacyText(parentColor, parentFormats);
	}

	public boolean equals(Object obj) {
		if (this == obj) {
			return true;
		} else if (!(obj instanceof ChatComponentWithLegacyText)) {
			return false;
		} else {
			ChatComponentWithLegacyText other = (ChatComponentWithLegacyText) obj;
			return this.component.equals(other.component) && this.getLegacyComponent().equals(other.getLegacyComponent());
		}
	}
}